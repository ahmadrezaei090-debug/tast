<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بازی مافیا - سناریوها</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- NEW DARK/PURPLE THEME --- */
        :root {
            --bg-primary: #121212; /* پس‌زمینه اصلی بسیار تیره */
            --bg-secondary: #1E1E1E; /* پس‌زمینه پنل‌ها */
            --text-primary: #E0E0E0; /* متن اصلی روشن */
            --text-secondary: #A0A0A0; /* متن ثانویه */
            --accent-primary: #9B59B6; /* بنفش اصلی */
            --accent-primary-dark: #8E44AD; /* بنفش تیره‌تر */
            --accent-hover: #AF7AC5; /* هاور بنفش */
            --border-color: #333333; /* رنگ حاشیه */
            --success: #2ECC71; /* سبز */
            --success-dark: #27AE60;
            --danger: #E74C3C; /* قرمز */
            --danger-dark: #C0392B;
        }

        /* --- KEYFRAME ANIMATIONS --- */
        @keyframes panel-intro {
            0% { opacity: 0; transform: scale(0.9) translateY(-20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 15px rgba(155, 89, 182, 0.2); }
            50% { transform: scale(1.03); box-shadow: 0 6px 25px rgba(155, 89, 182, 0.4); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInScaleUp {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes pulseGlow {
            0%, 100% { filter: drop-shadow(0 0 8px rgba(155, 89, 182, 0.4)); }
            50% { filter: drop-shadow(0 0 16px rgba(155, 89, 182, 0.8)); }
        }
        
        @keyframes tipFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fallAndFade {
            0% { transform: translateY(-100%); opacity: 0; }
            20% { transform: translateY(0); opacity: 1; }
            80% { transform: translateY(100px); opacity: 1; }
            100% { transform: translateY(150px); opacity: 0; }
        }

        /* --- BASE STYLES --- */
        body {
            font-family: 'Vazirmatn', sans-serif;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            overflow: hidden; 
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .panel-dark {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            transition: opacity 0.3s ease-in-out;
            position: relative;
        }

        .panel-hidden {
            opacity: 0;
            transform: scale(0.9) translateY(-20px);
            pointer-events: none;
            visibility: hidden;
        }

        .panel-visible {
            opacity: 1;
            transform: scale(1) translateY(0);
            visibility: visible;
            animation: panel-intro 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* --- BUTTON STYLES --- */
        .btn-theme {
            border-radius: 12px;
            font-weight: 700;
            text-transform: uppercase;
            transition: all 0.2s ease-out;
            cursor: pointer;
            position: relative;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 24px;
            font-size: 1.1rem;
        }
        @media (min-width: 640px) { .btn-theme { padding: 12px 30px; font-size: 1.25rem; } }
        
        .btn-theme:disabled {
            filter: grayscale(80%);
            cursor: not-allowed;
            background: #444;
            color: #888;
            border-color: #555;
            box-shadow: none !important;
            transform: translateY(0) !important;
        }

        .btn-primary {
            background-color: var(--accent-primary);
            border: 2px solid var(--accent-primary-dark);
            color: #ffffff;
            box-shadow: 0 5px 0 var(--accent-primary-dark), 0 6px 15px rgba(155, 89, 182, 0.3);
        }
        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 var(--accent-primary-dark), 0 8px 20px rgba(155, 89, 182, 0.4);
        }
        .btn-primary:active {
            transform: translateY(3px) !important;
            box-shadow: 0 2px 0 var(--accent-primary-dark) !important;
            transition-duration: 0.05s;
        }
        
        #scenarios-btn.breathing {
            animation: breathe 2.5s ease-in-out infinite;
        }
        
        .btn-secondary {
            background-color: transparent;
            border: 2px solid var(--accent-primary);
            color: var(--accent-primary);
            box-shadow: 0 5px 0 transparent; /* Placeholder for alignment */
        }
        .btn-secondary:hover {
            background-color: rgba(155, 89, 182, 0.1);
            color: var(--accent-hover);
            border-color: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 transparent;
        }
        .btn-secondary:active {
            transform: translateY(3px) !important;
            box-shadow: 0 2px 0 transparent !important;
            transition-duration: 0.05s;
        }

        /* --- INPUT & OPTION STYLES --- */
        .input-theme {
            background-color: var(--bg-primary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 10px;
            padding: 12px;
            font-size: 1rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
            -webkit-user-select: auto;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: auto;
            touch-action: manipulation;
        }
        .input-theme:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.4), 0 0 10px var(--accent-primary);
        }
        .input-theme.invalid {
            border-color: var(--danger);
        }
        .input-theme:read-only {
            background-color: #2a2a2a;
            cursor: default;
        }
        
        .option-btn {
            background: linear-gradient(to bottom, #444, #333);
            border: 2px solid #555;
            box-shadow: 0 4px 0 #222;
            color: white;
            transition: all 0.15s ease;
            font-size: 1rem;
            padding: 12px;
            border-radius: 12px;
            font-weight: bold;
        }
        .option-btn:hover:not(:disabled) {
            background: linear-gradient(to bottom, #555, #444);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #222;
        }
        .option-btn.correct {
            background: linear-gradient(to bottom, var(--success), var(--success-dark)) !important;
            border-color: #1E8449 !important;
            box-shadow: 0 4px 0 #145A32 !important;
            transform: translateY(0) !important;
        }
        .option-btn.incorrect {
            background: linear-gradient(to bottom, var(--danger), var(--danger-dark)) !important;
            border-color: #922B21 !important;
            box-shadow: 0 4px 0 #641E16 !important;
            transform: translateY(0) !important;
        }
        .option-btn:disabled { opacity: 0.8; cursor: not-allowed; }

        .loader {
            border: 8px solid #333;
            border-top: 8px solid var(--accent-primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--accent-primary); border-radius: 5px; border: 2px solid var(--bg-primary); }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-hover); }

        /* --- SCREEN STYLES --- */
        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100vh;
            padding: 10px;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            z-index: 1;
        }
        @media (min-width: 640px) { .screen { padding: 20px; } }
        #main-screen { justify-content: flex-start; }
        #loading-screen { 
            justify-content: center; 
            background: var(--bg-primary);
            position: fixed;
            z-index: 999;
        }
        .screen.active { opacity: 1; visibility: visible; position: relative; z-index: 10; }
        #loading-screen.active { position: fixed; z-index: 999; }
        #main-screen.active { position: absolute; z-index: 10; } 
        #game-screen.active { position: absolute; z-index: 10; } 
        #mind-game-screen.active { position: absolute; z-index: 10; }

        #loading-content-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 100%;
            max-width: 450px;
        }
        #escort-game-logo { /* NEW STYLE FOR ESCORT GAME LOGO */
            max-width: 200px;
            height: auto;
            margin-bottom: 1rem;
        }
        #loading-logo-svg {
            width: 120px;
            height: 120px;
            margin-bottom: 1.5rem;
            animation: fadeInScaleUp 1s ease-out, pulseGlow 3s infinite 1s;
            color: var(--accent-primary);
        }
        #loading-progress-bar-container {
            width: 100%;
            background-color: var(--border-color);
            border: 2px solid #2a2a2a;
            border-radius: 12px;
            padding: 4px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        #loading-progress-bar-fill {
            height: 18px;
            width: 0%;
            background: linear-gradient(to right, var(--accent-primary-dark), var(--accent-primary));
            border-radius: 8px;
            transition: width 0.5s ease-out;
            box-shadow: 0 0 10px var(--accent-primary);
        }
        #loading-message {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-primary);
            min-height: 28px;
        }
        #loading-tip {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
            background-color: rgba(0,0,0,0.25);
            padding: 8px 12px;
            border-radius: 8px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: tipFadeIn 0.8s ease-out;
        }

        .screen-content-wrapper {
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            padding-bottom: 10px;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        @media (min-width: 640px) { .screen-content-wrapper { padding-bottom: 20px; } }
        #main-screen .screen-content-wrapper {
            justify-content: space-between;
            min-height: calc(100vh - 20px);
            padding-top: 20px; 
        }
        @media (min-width: 640px) { #main-screen .screen-content-wrapper { min-height: calc(100vh - 40px); padding-top: 20px; } }


        #main-screen-header { 
            display: flex; justify-content: center;
            align-items: center; width: 100%; 
            padding: 1rem; margin-bottom: 1.5rem;
            background-color: var(--bg-secondary);
            border-radius: 12px;
            border: 2px solid var(--border-color);
            box-shadow: 0 6px 10px rgba(0,0,0,0.5);
            position: relative;
            z-index: 10;
        }
        
        #main-title {
            text-align: center;
            flex-grow: 1;
            font-size: 3rem;
            color: var(--accent-primary);
            font-weight: 900;
            text-shadow: 0 0 15px rgba(155, 89, 182, 0.4);
        }
        @media (min-width: 640px) { #main-title { font-size: 4.5rem; } }
        @media (min-width: 768px) { #main-title { font-size: 5.5rem; } }

        #main-screen-buttons-layout { display: flex; flex-direction: column; align-items: center; width: 100%; margin: auto 0; padding-top: 1rem; }
        #top-action-buttons { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 1rem; width: 100%; padding-bottom: 5px; margin-top: 2rem; }
        
        .hidden { display: none !important; }

        /* --- STYLES FOR POP-UP PANELS --- */
        #developers-panel-container, #game-mode-panel-container, #scenarios-list-panel-container, #scenario-detail-panel-container { 
            background-color: rgba(10, 10, 10, 0.85); 
        }
        #developers-panel, #game-mode-panel, #scenarios-list-panel, #scenario-detail-panel {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
        }
        
        .close-panel-btn {
            position: absolute; top: 12px; right: 12px; width: 40px; height: 40px;
            background: linear-gradient(to bottom, var(--danger), var(--danger-dark));
            border: 2px solid #7c2425;
            box-shadow: 0 4px 0 #8f2a2b;
            color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;
            font-weight: bold; line-height: 1; cursor: pointer; transition: all 0.2s ease;
        }
        .close-panel-btn:hover { transform: scale(1.1) rotate(90deg); }
        .close-panel-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #8f2a2b; }

        .developer-item {
            background-color: var(--bg-primary);
            padding: 1rem 1.2rem; border-radius: 12px;
            border: 2px solid var(--border-color);
        }
        .dev-header { border-bottom: 2px solid var(--border-color); }
        .dev-role-icon { font-size: 1.7em; color: var(--accent-primary); margin-left: 10px; }
        .dev-role { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); }
        .dev-username { color: var(--accent-hover); font-weight: bold; font-size: 1.25rem; }
        .dev-description { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.65; }

        #game-mode-panel .btn-primary {
            padding: 16px 32px;
            font-size: 1.5rem;
            width: 100%;
            max-width: 300px;
        }
        #game-mode-panel .btn-primary .icon {
            font-size: 2rem;
            margin-left: 12px;
        }

        /* --- NEW SCENARIO LIST STYLES --- */
        #scenario-list {
            text-align: right;
        }
        .scenario-item {
            background-color: var(--bg-primary);
            border: 2px solid var(--border-color);
            padding: 1rem 1.2rem;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer; /* Make it clickable */
        }
        .scenario-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(155, 89, 182, 0.2);
        }
        .scenario-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }
        .scenario-description {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* --- SCENARIO DETAIL PANEL STYLES (NEW) --- */
        .role-item {
            background-color: var(--bg-primary);
            padding: 1rem;
            border-radius: 10px;
            border-left: 4px solid var(--accent-primary);
        }
        .role-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        .role-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        /* --- TIMER STYLES --- */
        #timer-container {
            position: relative;
            width: 60px;
            height: 60px;
        }
        #timer-svg {
            transform: rotate(-90deg);
        }
        .timer-circle {
            fill: none;
            stroke-width: 8;
        }
        .timer-bg {
            stroke: var(--border-color);
        }
        .timer-progress {
            stroke: var(--accent-primary);
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear;
        }
        #timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--accent-primary);
        }
        
        /* --- MIND GAME STYLES --- */
        #mind-game-screen .screen-content-wrapper {
            justify-content: center;
        }
        #falling-sentence-container {
            height: 200px;
            width: 100%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        .falling-sentence {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-primary);
            text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
            animation: fallAndFade 4s ease-in-out forwards;
        }
        #mind-game-input-area {
            width: 100%;
            max-width: 500px;
        }

    </style>
</head>
<body>
    <!-- ===== LOADING SCREEN ===== -->
    <div id="loading-screen" class="screen active">
        <div id="loading-content-box">
            <!-- NEW: Escort Game Logo -->
            <img id="escort-game-logo" src="https://s6.uupload.ir/files/inshot_۲۰۲۵۱۰۲۶_۱۶۱۶۵۴۲۲۵_l1aa.jpg" alt="لوگوی اسکورت گیم">
            
            <!-- SVG جایگزین لوگو - آیکون ماسک تئاتر برای تم مافیا -->
            <svg id="loading-logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M14.22 6.01c.14.46-.02.97-.42 1.25l-.23.16c.38.3.61.73.61 1.21 0 .6-.32 1.13-.81 1.45l.17.12c.4.28.56.79.42 1.25-.14.46-.62.7-.99.52l-1.12-.54c-.23.15-.49.27-.77.36.1.48.51.82.99.82.55 0 1 .45 1 1s-.45 1-1 1H8c-.55 0-1-.45-1-1s.45-1 1-1c.48 0 .89-.34.99-.82-.28-.09-.54-.21-.77-.36l-1.12.54c-.37.18-.85-.06-.99-.52-.14-.46.02-.97.42-1.25l.17-.12c-.49-.32-.81-.85-.81-1.45 0-.48.23-.91.61-1.21l-.23-.16c-.4-.28-.56-.79-.42-1.25.14-.46.62-.7.99-.52l1.12.54c.26-.18.55-.3.86-.38-.1-.48-.51-.82-.99-.82-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1c-.48 0-.89.34-.99.82.31.08.6.2.86.38l1.12-.54c.37-.18.85.06.99.52zM12 8.01c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
            <h1 class="text-4xl sm:text-5xl font-black text-[var(--accent-primary)]" style="text-shadow: 0 0 10px rgba(155, 89, 182, 0.4);">شهر مافیا</h1>
            <div id="loading-progress-bar-container">
                <div id="loading-progress-bar-fill"></div>
            </div>
            <p id="loading-message" class="text-lg">در حال آماده سازی...</p>
            <p id="loading-tip">✨ به دنیای رمزآلود مافیا خوش آمدید... ✨</p>
        </div>
    </div>

    <!-- ===== MAIN SCREEN ===== -->
    <div id="main-screen" class="screen">
        <div class="screen-content-wrapper">
            <div>
                <div id="main-screen-header">
                    <h1 id="main-title" class="font-black">شهر مافیا</h1>
                </div>
            </div>

            <div id="main-screen-buttons-layout" class="pb-2 sm:pb-4">
                <button id="scenarios-btn" class="btn-theme btn-primary py-4 px-8 text-2xl breathing">سناریو ها</button>
                <button id="custom-scenario-btn" class="btn-theme btn-secondary mt-4">سناریو دست ساز (بزودی)</button>
                
                <div id="top-action-buttons">
                    <button id="challenge-btn" class="btn-theme btn-secondary">چالش</button>
                    <button id="developers-btn" class="btn-theme btn-secondary">👥 سازندگان</button>
                    <!-- "هماهنگی" button changed to "سناریو شما" -->
                    <button id="coordination-btn" class="btn-theme btn-secondary">سناریو شما</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== GAME SCREEN (MAFIA) ===== -->
    <div id="game-screen" class="screen">
        <div class="screen-content-wrapper justify-start">
            <div class="flex justify-between items-center mb-4 sm:mb-6 p-3 bg-[rgba(0,0,0,0.3)] rounded-lg text-lg w-full">
                <button id="back-to-main-btn-mafia" class="btn-theme btn-secondary text-sm !py-2 !px-4">بازگشت</button>
                <div class="font-bold">مرحله: <span id="stage-display" class="font-bold text-[var(--accent-primary)] text-2xl">1</span></div>
                <div id="timer-container">
                    <svg id="timer-svg" width="60" height="60" viewBox="0 0 60 60">
                        <circle class="timer-circle timer-bg" cx="30" cy="30" r="26"></circle>
                        <circle id="timer-progress-circle" class="timer-circle timer-progress" cx="30" cy="30" r="26"></circle>
                    </svg>
                    <span id="timer-text">20</span>
                </div>
            </div>
            <div id="question-container" class="panel-dark panel-visible p-4 sm:p-6 rounded-lg mb-4 sm:mb-6 min-h-[200px] flex flex-col justify-center w-full">
                <p id="question-text" class="text-xl md:text-2xl mb-6 text-center leading-relaxed font-bold">سوال بارگذاری می‌شود...</p>
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4"></div>
                <p id="question-explanation" class="text-sm mt-4 text-gray-400 bg-black/30 p-2 rounded-md text-center hidden"></p>
            </div>
            <div id="game-feedback" class="text-center text-lg font-semibold my-4 h-8"></div>
        </div>
    </div>

    <!-- ===== MIND GAME SCREEN ===== -->
    <div id="mind-game-screen" class="screen">
        <div class="screen-content-wrapper justify-start">
            <div class="flex justify-between items-center mb-4 sm:mb-6 p-3 bg-[rgba(0,0,0,0.3)] rounded-lg text-lg w-full">
                <button id="back-to-main-btn-mind" class="btn-theme btn-secondary text-sm !py-2 !px-4">بازگشت</button>
                <div class="font-bold">مرحله: <span id="mind-game-stage-display" class="font-bold text-[var(--accent-primary)] text-2xl">1</span></div>
                <div class="font-bold">امتیاز: <span id="mind-game-score-display" class="font-bold text-[var(--accent-primary)] text-2xl">0</span></div>
            </div>
            
            <div class="panel-dark p-6 w-full text-center">
                <h2 id="mind-game-instruction" class="text-2xl font-bold mb-4">جمله را به خاطر بسپار!</h2>
                <div id="falling-sentence-container">
                    <!-- The falling sentence will be injected here by JS -->
                </div>
                
                <div id="mind-game-input-area" class="hidden mx-auto">
                    <p class="mb-4">حالا جمله را تایپ کن:</p>
                    <input type="text" id="mind-game-input" class="input-theme w-full text-center text-lg mb-4" dir="rtl">
                    <button id="mind-game-submit-btn" class="btn-theme btn-primary">ثبت پاسخ</button>
                </div>
                
                <div id="mind-game-feedback" class="text-center text-lg font-semibold my-4 h-8"></div>
            </div>
        </div>
    </div>

    <!-- ===== MODAL CONTAINER ===== -->
    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 panel-hidden z-50">
        <div class="panel-dark p-6 sm:p-8 rounded-lg max-w-md md:max-lg w-full text-center">
            <h3 id="modal-title" class="text-2xl sm:text-3xl font-bold mb-4 text-[var(--accent-primary)]">توجه</h3>
            <div id="modal-content-dynamic">
                <p id="modal-message" class="mb-3 text-base leading-relaxed"></p> <!-- Added leading-relaxed for better readability -->
                <div class="flex justify-center gap-4 mt-4">
                    <button id="modal-confirm-btn" class="btn-theme btn-primary">تأیید</button>
                    <button id="modal-cancel-btn" class="btn-theme btn-secondary hidden">لغو</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== DEVELOPERS PANEL ===== -->
    <div id="developers-panel-container" class="fixed inset-0 flex items-center justify-center p-4 panel-hidden z-40">
        <div id="developers-panel" class="panel-dark p-6 sm:p-10 rounded-lg max-w-md w-full relative">
            <button id="close-developers-panel-btn" class="close-panel-btn">✕</button>
            <h3 class="text-center text-3xl font-bold mb-6 text-[var(--accent-primary)]">👥 سازندگان</h3>
            <div class="space-y-4">
                <div class="developer-item">
                    <div class="dev-header flex items-center mb-2 pb-2">
                        <span class="dev-role-icon">💻</span>
                        <span class="dev-role">برنامه‌نویسان</span>
                    </div>
                    <p class="dev-username">سید عباس سجادی و علی بابایی</p>
                    <p class="dev-description">پیاده‌سازی منطق و توسعه سمت کاربر (HTML, CSS, JavaScript).</p>
                </div>
                <div class="developer-item">
                    <div class="dev-header flex items-center mb-2 pb-2">
                        <span class="dev-role-icon">🎨</span>
                        <span class="dev-role">طراح رابط کاربری</span>
                    </div>
                    <p class="dev-username">وحید فریدونی</p>
                    <p class="dev-description">طراحی بصری، استایل‌ها و تجربه کاربری (UI/UX).</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== GAME MODE PANEL (kept for future use, but hidden by default now) ===== -->
    <div id="game-mode-panel-container" class="fixed inset-0 flex items-center justify-center p-4 panel-hidden z-40">
        <div id="game-mode-panel" class="panel-dark p-6 sm:p-10 rounded-lg max-w-md w-full relative text-center">
            <button id="close-game-mode-panel-btn" class="close-panel-btn">✕</button>
            <h3 class="text-center text-3xl font-bold mb-8 text-[var(--accent-primary)]">انتخاب بازی (دمو)</h3>
            <div class="space-y-6 flex flex-col items-center">
                <button id="mafia-mode-btn" class="btn-theme btn-primary">
                    بازجویی مافیا
                </button>
                <button id="mind-game-mode-btn" class="btn-theme btn-primary">
                     بازی ذهن
                </button>
            </div>
        </div>
    </div>
    
    <!-- ===== SCENARIOS LIST PANEL ===== -->
    <div id="scenarios-list-panel-container" class="fixed inset-0 flex items-center justify-center p-4 panel-hidden z-40">
        <div id="scenarios-list-panel" class="panel-dark p-6 sm:p-10 rounded-lg max-w-lg w-full relative text-center">
            <button id="close-scenarios-list-panel-btn" class="close-panel-btn">✕</button>
            <h3 class="text-center text-3xl font-bold mb-8 text-[var(--accent-primary)]">سناریوهای برتر</h3>
            
            <div id="scenario-list" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2 text-right">
                <!-- سناریو ۱ -->
                <div class="scenario-item" data-scenario="zodiac">
                    <h4 class="scenario-title">سناریو زودیاک (Zodiac)</h4>
                    <p class="scenario-description">یکی از جدیدترین و محبوب‌ترین سناریوها. قاتل سریالی (زودیاک) به تنهایی علیه مافیا و شهروندان بازی می‌کند. نقش‌های جدیدی مانند "محقق" و "قاتل" به بازی اضافه می‌شوند و پیچیدگی خاصی به بازی می‌دهند.</p>
                </div>
                <!-- سناریو ۲ -->
                <div class="scenario-item" data-scenario="classic">
                    <h4 class="scenario-title">سناریو شب‌های مافیا (کلاسیک پیشرفته)</h4>
                    <p class="scenario-description">بر اساس برنامه محبوب "شب‌های مافیا". شامل نقش‌های کلیدی مانند گاد فادر، دکتر لکتر، کارآگاه، روانشناس، تک‌تیرانداز، و شهروندان ساده است. تمرکز بر استدلال و فریبکاری است.</p>
                </div>
                <!-- سناریو ۳ -->
                <div class="scenario-item" data-scenario="negotiator">
                    <h4 class="scenario-title">سناریو مذاکره کننده (Negotiator)</h4>
                    <p class="scenario-description">در این سناریو، یک نقش مستقل به نام "مذاکره کننده" وجود دارد که هدفش زنده ماندن تا ۳ نفر نهایی است. او نه با مافیاست و نه با شهروندان و می‌تواند با هر دو طرف معامله کند.</p>
                </div>
                <!-- سناریو ۴ -->
                <div class="scenario-item" data-scenario="interrogator">
                    <h4 class="scenario-title">سناریو بازپرس (Interrogator)</h4>
                    <p class="scenario-description">تمرکز این سناریو بر نقش "بازپرس" است که می‌تواند در طول روز از یک نفر "بازجویی" کند. فرد بازجویی شده نمی‌تواند در رای‌گیری آن روز شرکت کند. این سناریو پویایی روز را تغییر می‌دهد.</p>
                </div>
            </div>

        </div>
    </div>
    
    <!-- ===== NEW: SCENARIO DETAIL PANEL ===== -->
    <div id="scenario-detail-panel-container" class="fixed inset-0 flex items-center justify-center p-4 panel-hidden z-40">
        <div id="scenario-detail-panel" class="panel-dark p-6 sm:p-10 rounded-lg max-w-lg w-full relative text-center">
            <button id="close-scenario-detail-panel-btn" class="close-panel-btn">✕</button>
            <h3 id="scenario-detail-title" class="text-center text-3xl font-bold mb-8 text-[var(--accent-primary)]">نقش‌های سناریو</h3>
            
            <div id="scenario-roles-list" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2 text-right">
                <!-- Role details will be injected here by JS -->
            </div>
        </div>
    </div>


<script>
    // --- SCENARIO DETAILS DATA (NEW) ---
    const scenarioDetails = {
        zodiac: {
            title: "نقش‌های سناریو زودیاک",
            roles: [
                { name: "زودیاک (قاتل سریالی)", description: "نقش مستقل که برای پیروزی باید آخرین نفر در بازی باشد. هر شب یک نفر را به قتل می‌رساند." },
                { name: "کارآگاه", description: "عضو تیم شهروندان. هر شب می‌تواند استعلام یک نفر را از گرداننده بگیرد." },
                { name: "محقق", description: "عضو تیم شهروندان. می‌تواند در مورد ارتباط بین دو نفر از گرداننده سوال کند." },
                { name: "پزشک", description: "عضو تیم شهروندان. هر شب می‌تواند جان یک نفر را نجات دهد." },
                { name: "تفنگدار", description: "عضو تیم شهروندان. در طول بازی تعداد محدودی گلوله دارد که می‌تواند در روز استفاده کند." },
                { name: "مافیای ساده", description: "عضو تیم مافیا. در فاز شب با هم‌تیمی‌های خود برای قتل یک شهروند مشورت می‌کند." },
            ]
        },
        classic: {
            title: "نقش‌های سناریو شب‌های مافیا",
            roles: [
                { name: "گاد فادر", description: "رئیس مافیا. استعلام او برای کارآگاه منفی است." },
                { name: "دکتر لکتر", description: "پزشک تیم مافیا. هر شب می‌تواند یکی از اعضای مافیا (جز خودش) را نجات دهد." },
                { name: "مافیای ساده", description: "عضو تیم مافیا که در تصمیم‌گیری شبانه برای قتل مشارکت دارد." },
                { name: "کارآگاه", description: "عضو تیم شهروندان. هر شب استعلام یک نفر را می‌گیرد." },
                { name: "پزشک", description: "عضو تیم شهروندان. هر شب جان یک نفر را نجات می‌دهد." },
                { name: "تک‌تیرانداز", description: "عضو شهروندان. می‌تواند در روز به دستور گرداننده به یک نفر شلیک کند." },
                { name: "روانشناس", description: "عضو شهروندان. هر شب می‌تواند قابلیت یک نفر را از او بگیرد." },
                { name: "شهروند ساده", description: "عضو تیم شهروندان که قابلیت خاصی ندارد و باید با استدلال مافیا را پیدا کند." },
            ]
        },
        negotiator: {
            title: "نقش‌های سناریو مذاکره‌کننده",
            roles: [
                { name: "مذاکره کننده", description: "نقش مستقل. هدف او زنده ماندن تا سه نفر آخر بازی است. می‌تواند با هر دو ساید بازی کند." },
                { name: "مافیا", description: "تیم مافیا که هدفشان برابر کردن تعدادشان با شهروندان است." },
                { name: "کارآگاه", description: "عضو تیم شهروندان برای شناسایی مافیا." },
                { name: "پزشک", description: "محافظ جان شهروندان در برابر شلیک شبانه مافیا." },
                { name: "شهروند ساده", description: "بدنه اصلی تیم شهروندان." },
            ]
        },
        interrogator: {
            title: "نقش‌های سناریو بازپرس",
            roles: [
                { name: "بازپرس", description: "عضو تیم شهروندان. می‌تواند در طول روز یک نفر را بازجویی کند و فرد مورد نظر حق رای آن روز را از دست می‌دهد." },
                { name: "مافیا", description: "تیم مافیا با هدف حذف شهروندان." },
                { name: "گاد فادر", description: "رئیس مافیا که استعلامش منفی است." },
                { name: "پزشک", description: "ناجی شهروندان در شب." },
                { name: "حرفه‌ای", description: "شهروندی که اگر توسط مافیا هدف قرار گیرد، می‌تواند یکی از مافیاها را با خود از بازی خارج کند." },
            ]
        }
    };

    // --- MAFIA Game Data ---
    const mafiaGameData = [
        {
            question: "کدام نقش در بازی مافیا توانایی نجات دادن یک نفر از تیر مافیا در شب را دارد؟",
            options: ["مافیا", "شهروند ساده", "کارآگاه", "دکتر"],
            answer: "دکتر",
            explanation: "نقش دکتر یا پزشک می‌تواند هر شب یک نفر (از جمله خودش) را از حملات مافیا نجات دهد."
        },
        {
            question: "هدف اصلی تیم مافیا در شب چیست؟",
            options: ["شلیک به یک شهروند", "بحث و گفتگو", "شناسایی نقش‌های شهروند", "انتخاب شهردار"],
            answer: "شلیک به یک شهروند",
            explanation: "وظیفه اصلی تیم مافیا هر شب، حذف یک نفر از شهروندان است تا نسبت تعدادشان برابر شود و پیروز شوند."
        },
        {
            question: "نقش «کارآگاه» در فاز روز چه مزیتی نسبت به شهروندان عادی دارد؟",
            options: ["دارای حق شلیک است.", "از شب قبل به نقش یک نفر پی برده است.", "می‌تواند حکم را صادر کند.", "می‌تواند سکوت کند."],
            answer: "از شب قبل به نقش یک نفر پی برده است.",
            explanation: "کارآگاه (یا بازپرس) هر شب می‌تواند از نقش یک نفر استعلام بگیرد و در روز از این اطلاعات برای هدایت بحث استفاده کند."
        },
        {
            question: "چه زمانی بازی مافیا به پایان می‌رسد؟",
            options: ["پس از ۵ دور بازی", "وقتی تعداد شهروندان و مافیا برابر شود.", "وقتی فقط دو نفر باقی بمانند.", "وقتی شهردار انتخاب شود."],
            answer: "وقتی تعداد شهروندان و مافیا برابر شود.",
            explanation: "مافیا زمانی پیروز می‌شود که تعداد اعضای مافیا برابر یا بیشتر از تعداد شهروندان شود (سناریوهای استاندارد)."
        }
    ];
    
    // --- MIND Game Data ---
    const mindGameSentences = [
        "سکوت همیشه به معنای رضایت نیست",
        "موفقیت نتیجه تلاش های کوچک روزانه است",
        "زندگی مثل دوچرخه سواری است برای حفظ تعادل باید حرکت کنی",
        "تنها راه انجام کارهای بزرگ دوست داشتن کاری است که انجام میدهی",
        "آینده متعلق به کسانی است که به زیبایی رویاهایشان ایمان دارند"
    ];

    // --- DOM Elements ---
    const loadingScreen = document.getElementById('loading-screen');
    const mainScreen = document.getElementById('main-screen');
    const gameScreen = document.getElementById('game-screen');
    const mindGameScreen = document.getElementById('mind-game-screen');

    // --- Main Screen Buttons ---
    const scenariosBtn = document.getElementById('scenarios-btn');
    const customScenarioBtn = document.getElementById('custom-scenario-btn');
    const developersBtn = document.getElementById('developers-btn');
    const challengeBtn = document.getElementById('challenge-btn');
    const coordinationBtn = document.getElementById('coordination-btn');

    // --- Panels and Containers ---
    const scenariosListPanelContainer = document.getElementById('scenarios-list-panel-container');
    const closeScenariosListPanelBtn = document.getElementById('close-scenarios-list-panel-btn');
    const scenarioDetailPanelContainer = document.getElementById('scenario-detail-panel-container'); // NEW
    const closeScenarioDetailPanelBtn = document.getElementById('close-scenario-detail-panel-btn'); // NEW

    // Mafia Game Elements
    const backToMainBtnMafia = document.getElementById('back-to-main-btn-mafia');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const stageDisplay = document.getElementById('stage-display');
    const gameFeedback = document.getElementById('game-feedback');
    const questionExplanation = document.getElementById('question-explanation');
    const timerText = document.getElementById('timer-text');
    const timerProgressCircle = document.getElementById('timer-progress-circle');
    const circleRadius = 26;
    const circleCircumference = 2 * Math.PI * circleRadius;
    timerProgressCircle.style.strokeDasharray = `${circleCircumference} ${circleCircumference}`;
    timerProgressCircle.style.strokeDashoffset = circleCircumference;

    // Mind Game Elements
    const backToMainBtnMind = document.getElementById('back-to-main-btn-mind');
    const mindGameInstruction = document.getElementById('mind-game-instruction');
    const fallingSentenceContainer = document.getElementById('falling-sentence-container');
    const mindGameInputArea = document.getElementById('mind-game-input-area');
    const mindGameInput = document.getElementById('mind-game-input');
    const mindGameSubmitBtn = document.getElementById('mind-game-submit-btn');
    const mindGameFeedback = document.getElementById('mind-game-feedback');
    const mindGameStageDisplay = document.getElementById('mind-game-stage-display');
    const mindGameScoreDisplay = document.getElementById('mind-game-score-display');
    
    // Modal & Panels Elements
    const modalContainer = document.getElementById('modal-container');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const modalConfirmBtn = document.getElementById('modal-confirm-btn');
    const modalCancelBtn = document.getElementById('modal-cancel-btn');
    const developersPanelContainer = document.getElementById('developers-panel-container');
    const closeDevelopersPanelBtn = document.getElementById('close-developers-panel-btn');
    
    // Demo Game Mode Panel
    const gameModePanelContainer = document.getElementById('game-mode-panel-container');
    const closeGameModePanelBtn = document.getElementById('close-game-mode-panel-btn');
    const mafiaModeBtn = document.getElementById('mafia-mode-btn');
    const mindGameModeBtn = document.getElementById('mind-game-mode-btn');

    // --- Game State ---
    let currentMafiaStage = 0;
    let mafiaTimerInterval;
    let mafiaGameTime = 20;
    let currentMindGameStage = 0;
    let mindGameScore = 0;
    let currentMindGameSentence = "";
    let mindGameTimer;

    // --- Utility Functions ---
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        const screenToShow = document.getElementById(screenId);
        if (screenToShow) {
            screenToShow.classList.add('active');
        }
    }

    function showModal(title, message, confirmText = 'تأیید', confirmCallback = null, showCancel = false) {
        modalTitle.textContent = title;
        modalMessage.innerHTML = message; // Use innerHTML to allow for potential formatting
        modalConfirmBtn.textContent = confirmText;
        
        modalCancelBtn.classList.toggle('hidden', !showCancel);

        const newConfirmBtn = modalConfirmBtn.cloneNode(true);
        modalConfirmBtn.parentNode.replaceChild(newConfirmBtn, modalConfirmBtn);
        
        const newModalConfirmBtn = document.getElementById('modal-confirm-btn');
        
        newModalConfirmBtn.onclick = () => {
            modalContainer.classList.add('panel-hidden');
            if (confirmCallback) {
                confirmCallback();
            }
        };

        modalCancelBtn.onclick = () => {
            modalContainer.classList.add('panel-hidden');
        };

        modalContainer.classList.remove('panel-hidden');
    }

    function simulateLoading() {
        const progressBar = document.getElementById('loading-progress-bar-fill');
        const loadingMessage = document.getElementById('loading-message');
        const loadingTip = document.getElementById('loading-tip');
        
        const tips = [
            "✨ به دنیای رمزآلود مافیا خوش آمدید... ✨",
            "🤫 سکوت نشانه‌ی شهروندی نیست...",
            "🔎 کارآگاه، مراقب استعلام‌هایت باش!",
            "❤️ دکتر، تو امید شهر هستی...",
            "🎯 تک‌تیرانداز، فقط یک گلوله داری!"
        ];
        
        let progress = 0;
        let tipIndex = 0;

        const interval = setInterval(() => {
            progress += Math.floor(Math.random() * 15) + 10;
            if (progress >= 100) {
                progress = 100;
                clearInterval(interval);
                loadingMessage.textContent = 'آماده شد!';
                
                const scenariosBtnElement = document.getElementById('scenarios-btn');
                if (scenariosBtnElement) {
                     scenariosBtnElement.classList.add('breathing');
                }

                setTimeout(() => {
                    showScreen('main-screen');
                }, 800);
            }
            
            progressBar.style.width = `${progress}%`;
            
            if (progress > 30 && progress < 70) {
                loadingMessage.textContent = 'در حال بارگذاری منطق بازی...';
            } else if (progress >= 70) {
                loadingMessage.textContent = 'آماده‌سازی پنل‌ها...';
            }

            if (progress % 30 < 15 && progress > 15) {
                tipIndex = (tipIndex + 1) % tips.length;
                loadingTip.style.opacity = 0;
                setTimeout(() => {
                    loadingTip.innerHTML = tips[tipIndex];
                    loadingTip.style.opacity = 1;
                }, 300);
            }

        }, 400);
    }
    
    // --- Mafia Game Logic ---
    function startMafiaGame() {
        currentMafiaStage = 0;
        loadMafiaQuestion();
        showScreen('game-screen');
    }

    function loadMafiaQuestion() {
        if (currentMafiaStage >= mafiaGameData.length) {
            endMafiaGame("پیروزی!", "شما تمام سوالات بازجویی را با موفقیت پشت سر گذاشتید!");
            return;
        }
        resetMafiaTimer();
        const data = mafiaGameData[currentMafiaStage];
        stageDisplay.textContent = currentMafiaStage + 1;
        questionText.textContent = data.question;
        questionExplanation.classList.add('hidden');
        questionExplanation.textContent = data.explanation;
        optionsContainer.innerHTML = '';
        
        data.options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-btn';
            button.textContent = option;
            button.onclick = () => checkMafiaAnswer(button, option, data.answer);
            optionsContainer.appendChild(button);
        });
        startMafiaTimer();
    }

    function checkMafiaAnswer(button, selectedAnswer, correctAnswer) {
        clearInterval(mafiaTimerInterval);
        disableOptions();
        
        if (selectedAnswer === correctAnswer) {
            button.classList.add('correct');
            gameFeedback.textContent = 'درست بود!';
            gameFeedback.style.color = 'var(--success)';
            currentMafiaStage++;
            setTimeout(loadMafiaQuestion, 2000);
        } else {
            button.classList.add('incorrect');
            gameFeedback.textContent = 'اشتباه بود!';
            gameFeedback.style.color = 'var(--danger)';
            optionsContainer.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.textContent === correctAnswer) btn.classList.add('correct');
            });
            questionExplanation.classList.remove('hidden');
            setTimeout(() => {
                 endMafiaGame("بازجویی ناموفق!", "شما در بازجویی شکست خوردید و هویتتان لو رفت.");
            }, 3500);
        }
    }

    function disableOptions() {
        optionsContainer.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
    }

    function startMafiaTimer() {
        mafiaGameTime = 20;
        timerText.textContent = mafiaGameTime;
        updateTimerProgress(1);
        mafiaTimerInterval = setInterval(() => {
            mafiaGameTime--;
            timerText.textContent = mafiaGameTime;
            updateTimerProgress(mafiaGameTime / 20);
            if (mafiaGameTime <= 0) {
                clearInterval(mafiaTimerInterval);
                timeUp();
            }
        }, 1000);
    }

    function resetMafiaTimer() {
        clearInterval(mafiaTimerInterval);
        timerText.textContent = 20;
        updateTimerProgress(1);
    }
    
    function updateTimerProgress(progressFraction) {
        const offset = circleCircumference * (1 - progressFraction);
        timerProgressCircle.style.strokeDashoffset = offset;
    }

    function timeUp() {
        disableOptions();
        gameFeedback.textContent = 'زمان تمام شد!';
        gameFeedback.style.color = 'var(--danger)';
        questionExplanation.classList.remove('hidden');
        setTimeout(() => {
            endMafiaGame("وقت تمام شد!", "شما نتوانستید به موقع پاسخ دهید و بازجویی را باختید.");
        }, 3500);
    }
    
    function endMafiaGame(title, message) {
        resetMafiaTimer();
        showModal(title, message, 'بازی مجدد', () => startMafiaGame(), true);
        modalCancelBtn.textContent = 'بازگشت به منو';
        modalCancelBtn.onclick = () => {
            modalContainer.classList.add('panel-hidden');
            showScreen('main-screen');
        };
    }

    // --- Mind Game Logic ---
    function startMindGame() {
        currentMindGameStage = 0;
        mindGameScore = 0;
        mindGameStageDisplay.textContent = 1;
        mindGameScoreDisplay.textContent = 0;
        loadMindGameStage();
        showScreen('mind-game-screen');
    }
    
    function loadMindGameStage() {
        mindGameInput.value = "";
        mindGameInput.classList.remove('invalid');
        mindGameFeedback.textContent = "";
        mindGameInputArea.classList.add('hidden');
        fallingSentenceContainer.innerHTML = "";
        currentMindGameSentence = mindGameSentences[currentMindGameStage % mindGameSentences.length];
        const sentenceEl = document.createElement('div');
        sentenceEl.className = 'falling-sentence';
        sentenceEl.textContent = currentMindGameSentence;
        fallingSentenceContainer.appendChild(sentenceEl);
        mindGameInstruction.textContent = "جمله را به خاطر بسپار!";
        clearTimeout(mindGameTimer);
        mindGameTimer = setTimeout(() => {
            mindGameInstruction.textContent = "حالا جمله را تایپ کن:";
            mindGameInputArea.classList.remove('hidden');
            mindGameInput.focus();
        }, 4000);
    }
    
    function checkMindGameAnswer() {
        const playerInput = mindGameInput.value.trim().replace(/\s+/g, ' ');
        const correctSentence = currentMindGameSentence.replace(/\s+/g, ' ');

        if (playerInput === correctSentence) {
            mindGameScore += 10;
            currentMindGameStage++;
            mindGameScoreDisplay.textContent = mindGameScore;
            mindGameStageDisplay.textContent = currentMindGameStage + 1;
            mindGameFeedback.textContent = "عالی بود! مرحله بعد...";
            mindGameFeedback.style.color = 'var(--success)';
            mindGameInput.classList.remove('invalid');
            setTimeout(loadMindGameStage, 2000);
        } else {
            mindGameScore = Math.max(0, mindGameScore - 5);
            mindGameScoreDisplay.textContent = mindGameScore;
            mindGameFeedback.textContent = "اشتباه بود! دوباره تلاش کن.";
            mindGameFeedback.style.color = 'var(--danger)';
            mindGameInput.classList.add('invalid');
            if (navigator.vibrate) navigator.vibrate(300);
        }
    }
    
    // --- NEW: Function to display scenario details ---
    function displayScenarioDetails(scenarioId) {
        const details = scenarioDetails[scenarioId];
        if (!details) return;

        const detailTitle = document.getElementById('scenario-detail-title');
        const rolesList = document.getElementById('scenario-roles-list');

        detailTitle.textContent = details.title;
        rolesList.innerHTML = ''; // Clear previous roles

        details.roles.forEach(role => {
            const roleEl = document.createElement('div');
            roleEl.className = 'role-item';
            roleEl.innerHTML = `
                <h5 class="role-name">${role.name}</h5>
                <p class="role-description">${role.description}</p>
            `;
            rolesList.appendChild(roleEl);
        });

        scenariosListPanelContainer.classList.add('panel-hidden'); // Hide the list
        scenarioDetailPanelContainer.classList.remove('panel-hidden'); // Show the details
    }


    // --- Event Listeners ---
    scenariosBtn.addEventListener('click', () => {
        scenariosListPanelContainer.classList.remove('panel-hidden');
    });
    
    customScenarioBtn.addEventListener('click', () => {
        showModal('به زودی...', 'بخش ساخت سناریوی دست‌ساز در حال توسعه است و به زودی در دسترس شما قرار خواهد گرفت.', 'باشه');
    });
    
    closeScenariosListPanelBtn.addEventListener('click', () => {
        scenariosListPanelContainer.classList.add('panel-hidden');
    });

    // --- NEW: Event listeners for scenario items ---
    document.querySelectorAll('.scenario-item').forEach(item => {
        item.addEventListener('click', () => {
            const scenarioId = item.dataset.scenario;
            displayScenarioDetails(scenarioId);
        });
    });

    closeScenarioDetailPanelBtn.addEventListener('click', () => {
        scenarioDetailPanelContainer.classList.add('panel-hidden');
        scenariosListPanelContainer.classList.remove('panel-hidden'); // Optionally re-open the list
    });

    // For demo game panel (if you decide to use it later)
    closeGameModePanelBtn.addEventListener('click', () => gameModePanelContainer.classList.add('panel-hidden'));
    mafiaModeBtn.addEventListener('click', () => {
        gameModePanelContainer.classList.add('panel-hidden');
        startMafiaGame();
    });
    mindGameModeBtn.addEventListener('click', () => {
        gameModePanelContainer.classList.add('panel-hidden');
        startMindGame();
    });
    
    developersBtn.addEventListener('click', () => developersPanelContainer.classList.remove('panel-hidden'));
    closeDevelopersPanelBtn.addEventListener('click', () => developersPanelContainer.classList.add('panel-hidden'));
    
    challengeBtn.addEventListener('click', () => {
        showModal('چالش', 'بخش چالش‌های روزانه در دست طراحی است و به زودی اضافه خواهد شد.', 'باشه');
    });
    
    coordinationBtn.addEventListener('click', () => {
        showModal(
            'سناریو شما',
            'در این بخش سناریوهایی که توسط کاربران عزیز ساخته شده، نمایش داده می‌شود. برای اینکه سناریوی شما هم در این بخش قرار بگیرد، می‌توانید آن را به آیدی تلگرام <strong>ESCORTGAME_Support@</strong> ارسال کنید.',
            'فهمیدم'
        );
    });

    backToMainBtnMafia.addEventListener('click', () => {
        showModal('خروج از بازی', 'آیا مطمئن هستید که می‌خواهید از بازجویی خارج شوید؟', 'بله، خارج شو', () => {
            resetMafiaTimer();
            showScreen('main-screen');
        }, true);
    });
    
    backToMainBtnMind.addEventListener('click', () => {
        showModal('خروج از بازی', 'آیا مطمئن هستید که می‌خواهید از بازی ذهن خارج شوید؟', 'بله، خارج شو', () => {
            clearTimeout(mindGameTimer);
            showScreen('main-screen');
        }, true);
    });
    
    mindGameSubmitBtn.addEventListener('click', checkMindGameAnswer);
    mindGameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkMindGameAnswer();
    });

    // --- App Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        showScreen('loading-screen');
        simulateLoading();
    });

</script>
</body>
</html>
